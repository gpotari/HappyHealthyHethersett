<section id="events" class="section section--alt" aria-labelledby="events-title">
  <div class="container">
    <header class="section__header">
      <h2 id="events-title">Upcoming events</h2>
      <p class="section__intro">
        Come along to one of our friendly sessions — there is something for everyone, from practical action days to informative workshops.
      </p>
    </header>
    <ng-container *ngIf="events$ | async as events; else noEvents">
      <div class="stack stack--events" role="list" *ngIf="events.length; else noEvents">
        <article
          class="event-card"
          role="listitem"
          *ngFor="let event of events; let i = index"
          [attr.aria-labelledby]="'event-' + i + '-title'"
        >
          <div class="event-card__header">
            <h3 [id]="'event-' + i + '-title'">{{ event.title }}</h3>
            <p class="event-card__meta">
              <time [attr.datetime]="formatDateTime(event.date, event.start)">{{ formatEventDate(event) }}</time>
              <ng-container *ngIf="event.location"> • {{ event.location }}</ng-container>
            </p>
          </div>
          <button
            *ngIf="event.imageUrl"
            class="event-card__image-button"
            type="button"
            (click)="openImage(event)"
            aria-label="View event image"
          >
            <img
              class="event-card__image"
              [src]="event.imageUrl"
              [alt]="event.imageAlt || event.title"
              loading="lazy"
            />
          </button>
          <p>{{ event.description }}</p>
          <a class="btn btn--secondary" *ngIf="event.ctaHref" [href]="event.ctaHref">
            {{ ctaLabel(event) }}
          </a>
          <p class="event-card__meta" *ngIf="event.note">
            <ng-container *ngIf="event.phone && noteParts(event) as parts; else plainNote">
              {{ parts.before }}<a [href]="phoneLink(event.phone)">{{ event.phone }}</a>{{ parts.after }}
            </ng-container>
            <ng-template #plainNote>{{ event.note }}</ng-template>
          </p>
        </article>
      </div>
    </ng-container>
    <ng-template #noEvents>
      <div class="card">
        <p>There are no upcoming events scheduled right now. Please check back soon.</p>
      </div>
    </ng-template>
  </div>
</section>

<div class="event-lightbox" *ngIf="activeImageUrl" (click)="closeImage()">
  <div class="event-lightbox__dialog" role="dialog" aria-modal="true" (click)="$event.stopPropagation()">
    <button class="event-lightbox__close" type="button" (click)="closeImage()" aria-label="Close image">
      ×
    </button>
    <img class="event-lightbox__image" [src]="activeImageUrl" [alt]="activeImageAlt" />
  </div>
</div>
